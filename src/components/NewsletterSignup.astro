---
---

<div class="newsletter-signup bg-gradient-to-r from-primary-600 to-secondary-600 rounded-2xl p-8 text-white my-12">
  <div class="max-w-2xl mx-auto text-center">
    <div class="w-16 h-16 bg-white/10 rounded-2xl flex items-center justify-center mx-auto mb-6">
      <i class="fas fa-envelope text-2xl"></i>
    </div>
    
    <h3 class="text-2xl font-bold mb-4">
      🎯 لا تفوت أي جديد في عالم الأمان
    </h3>
    
    <p class="text-white/90 mb-6">
      احصل على أحدث المراجعات والنصائح الأمنية مباشرة في بريدك الإلكتروني
      <br>
      <span class="text-sm opacity-75">نرسل محتوى حصري أسبوعياً</span>
    </p>
    
    <form class="flex flex-col sm:flex-row gap-4 max-w-md mx-auto" id="newsletter-form" action="/api/newsletter" method="POST">
      <input 
        type="email" 
        name="email"
        placeholder="بريدك الإلكتروني"
        class="flex-1 px-4 py-3 rounded-lg border-0 text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-white/50"
        required
      />
      <input type="text" name="company" class="hidden" tabindex="-1" autocomplete="off" aria-hidden="true" />
      <button 
        type="submit"
        class="px-6 py-3 bg-white text-primary-600 font-semibold rounded-lg hover:bg-gray-100 transition-colors shadow-md hover:shadow-lg"
      >
        اشتراك مجاني
      </button>
    </form>
    
    <div id="newsletter-message" class="mt-4 text-center text-sm" style="display: none;"></div>
    
    <div class="flex items-center justify-center mt-4 text-sm text-white/70">
      <i class="fas fa-shield-alt ml-2"></i>
      نحترم خصوصيتك - لا سبام أبداً
    </div>
  </div>
</div>

<script>
  const form = document.getElementById('newsletter-form');
  const message = document.getElementById('newsletter-message');
  
  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const button = form.querySelector('button');
    const originalText = button.innerHTML;
    const formData = new FormData(form);
    
    // Show loading state
    button.innerHTML = '<i class="fas fa-spinner fa-spin ml-2"></i>جاري الاشتراك...';
    button.disabled = true;
    message.style.display = 'none';
    
    try {
      const response = await fetch(form.action, { 
        method: 'POST', 
        body: formData 
      });
      
      const data = await response.json();
      
      // Show message
      message.textContent = data.message || (data.ok ? "تم الاشتراك" : "تعذّر الاشتراك");
      message.style.display = 'block';
      message.className = `mt-4 text-center text-sm ${data.ok ? 'text-green-200' : 'text-red-200'}`;
      
      if (data.ok) {
        // Success state
        button.innerHTML = '<i class="fas fa-check ml-2"></i>تم الإرسال';
        button.classList.remove('bg-white', 'text-primary-600');
        button.classList.add('bg-green-500', 'text-white');
        
        // Analytics
        if (typeof gtag !== 'undefined') {
          gtag('event', 'newsletter_signup', {
            email: formData.get('email')
          });
        }
        
        form.reset();
        
        // Reset button after 4 seconds
        setTimeout(() => {
          button.innerHTML = originalText;
          button.disabled = false;
          button.classList.remove('bg-green-500', 'text-white');
          button.classList.add('bg-white', 'text-primary-600');
        }, 4000);
        
      } else {
        // Error state
        button.innerHTML = '<i class="fas fa-exclamation-triangle ml-2"></i>خطأ';
        button.classList.remove('bg-white', 'text-primary-600');
        button.classList.add('bg-red-500', 'text-white');
        
        // Reset button after 4 seconds
        setTimeout(() => {
          button.innerHTML = originalText;
          button.disabled = false;
          button.classList.remove('bg-red-500', 'text-white');
          button.classList.add('bg-white', 'text-primary-600');
        }, 4000);
      }
      
    } catch (error) {
      console.error('Newsletter signup error:', error);
      
      // Error state
      message.textContent = "تعذّر الاشتراك. حاول لاحقًا.";
      message.style.display = 'block';
      message.className = 'mt-4 text-center text-sm text-red-200';
      
      button.innerHTML = '<i class="fas fa-exclamation-triangle ml-2"></i>خطأ في الاتصال';
      button.classList.remove('bg-white', 'text-primary-600');
      button.classList.add('bg-red-500', 'text-white');
      
      // Reset button after 4 seconds
      setTimeout(() => {
        button.innerHTML = originalText;
        button.disabled = false;
        button.classList.remove('bg-red-500', 'text-white');
        button.classList.add('bg-white', 'text-primary-600');
      }, 4000);
    }
  });
</script>