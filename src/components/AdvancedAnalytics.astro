---
// Ù…ÙƒÙˆÙ† Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
---

<script>
  // Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ù„Ù…Ø¯ÙˆÙ†Ø© Ø¹Ø²ÙŠØ²
  document.addEventListener('DOMContentLoaded', function() {
    console.log('ğŸ“ˆ Advanced Analytics: Initializing...');
    
    // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØªØ¨Ø¹
    let scrollDepth = 0;
    let maxScrollDepth = 0;
    let timeOnPage = Date.now();
    let isReturningVisitor = localStorage.getItem('visited_before') === 'true';
    let sessionStartTime = Date.now();
    let engagementEvents = 0;
    
    // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    const userType = isReturningVisitor ? 'returning' : 'new';
    localStorage.setItem('visited_before', 'true');
    
    // ØªØªØ¨Ø¹ Ø¹Ù…Ù‚ Ø§Ù„ØªÙ…Ø±ÙŠØ±
    function trackScrollDepth() {
      const scrollTop = window.pageYOffset;
      const docHeight = document.documentElement.scrollHeight - window.innerHeight;
      const scrollPercent = Math.round((scrollTop / docHeight) * 100);
      
      if (scrollPercent > maxScrollDepth) {
        maxScrollDepth = scrollPercent;
        
        // ØªØªØ¨Ø¹ Ù…Ø¹Ø§Ù„Ù… Ø§Ù„ØªÙ…Ø±ÙŠØ±
        if (scrollPercent >= 25 && scrollDepth < 25) {
          gtag('event', 'scroll', {
            event_category: 'engagement',
            event_label: '25%',
            value: 25
          });
        }
        if (scrollPercent >= 50 && scrollDepth < 50) {
          gtag('event', 'scroll', {
            event_category: 'engagement',
            event_label: '50%',
            value: 50
          });
        }
        if (scrollPercent >= 75 && scrollDepth < 75) {
          gtag('event', 'scroll', {
            event_category: 'engagement',
            event_label: '75%',
            value: 75
          });
        }
        if (scrollPercent >= 90 && scrollDepth < 90) {
          gtag('event', 'scroll', {
            event_category: 'engagement',
            event_label: '90%',
            value: 90
          });
        }
        
        scrollDepth = scrollPercent;
      }
    }
    
    // ØªØªØ¨Ø¹ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù‚Ø¶ÙŠ ÙÙŠ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©
    function trackReadingTime() {
      const timeSpent = Math.round((Date.now() - timeOnPage) / 1000);
      
      // ØªØªØ¨Ø¹ Ù…Ø¹Ø§Ù„Ù… Ø§Ù„ÙˆÙ‚Øª
      if (timeSpent >= 30 && !window.tracked_30s) {
        gtag('event', 'timing_complete', {
          name: 'reading_time',
          value: 30,
          event_category: 'engagement'
        });
        window.tracked_30s = true;
      }
      
      if (timeSpent >= 60 && !window.tracked_60s) {
        gtag('event', 'timing_complete', {
          name: 'reading_time',
          value: 60,
          event_category: 'engagement'
        });
        window.tracked_60s = true;
      }
      
      if (timeSpent >= 180 && !window.tracked_180s) {
        gtag('event', 'timing_complete', {
          name: 'reading_time',
          value: 180,
          event_category: 'engagement'
        });
        window.tracked_180s = true;
      }
    }
    
    // ØªØªØ¨Ø¹ Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰
    function trackContentInteraction(element, action) {
      engagementEvents++;
      
      gtag('event', action, {
        event_category: 'content_interaction',
        event_label: element,
        value: engagementEvents
      });
    }
    
    // ØªØªØ¨Ø¹ Ø§Ù„Ù†Ù‚Ø±Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©
    document.addEventListener('click', function(e) {
      const link = e.target.closest('a');
      if (link && link.href) {
        const url = new URL(link.href, window.location.href);
        
        // Ø±Ø§Ø¨Ø· Ø®Ø§Ø±Ø¬ÙŠ
        if (url.hostname !== window.location.hostname) {
          gtag('event', 'click', {
            event_category: 'outbound_link',
            event_label: url.hostname,
            transport_type: 'beacon'
          });
        }
        
        // Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªØ§Ø¨Ø¹Ø© (Affiliate)
        if (link.classList.contains('affiliate-link') || 
            link.href.includes('amazon.com') || 
            link.href.includes('affiliate')) {
          gtag('event', 'click', {
            event_category: 'affiliate_link',
            event_label: link.textContent.trim(),
            transport_type: 'beacon'
          });
        }
        
        // Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ
        if (url.hostname.includes('twitter.com') || 
            url.hostname.includes('linkedin.com') || 
            url.hostname.includes('whatsapp.com')) {
          gtag('event', 'share', {
            method: url.hostname.split('.')[0],
            content_type: 'article',
            item_id: window.location.pathname
          });
        }
      }
    });
    
    // ØªØªØ¨Ø¹ Ø§Ù„Ø¨Ø­Ø«
    const searchInput = document.querySelector('#search-input, [type="search"]');
    if (searchInput) {
      searchInput.addEventListener('input', function() {
        if (this.value.length >= 3) {
          gtag('event', 'search', {
            search_term: this.value,
            event_category: 'site_search'
          });
        }
      });
    }
    
    // ØªØªØ¨Ø¹ ØªÙØ§Ø¹Ù„ Ø§Ù„Ù†Ø´Ø±Ø© Ø§Ù„Ø¨Ø±ÙŠØ¯ÙŠØ©
    const newsletterForm = document.querySelector('#newsletter-form');
    if (newsletterForm) {
      newsletterForm.addEventListener('submit', function() {
        gtag('event', 'sign_up', {
          method: 'newsletter',
          event_category: 'engagement'
        });
      });
    }
    
    // ØªØªØ¨Ø¹ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±
    const images = document.querySelectorAll('img[data-src]');
    if (images.length > 0) {
      const imageObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            gtag('event', 'view_item', {
              event_category: 'image_load',
              event_label: entry.target.alt || 'unnamed_image'
            });
          }
        });
      });
      
      images.forEach(img => imageObserver.observe(img));
    }
    
    // ØªØªØ¨Ø¹ Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (Ø¥Ø°Ø§ ÙˆØ¬Ø¯)
    const videos = document.querySelectorAll('video');
    videos.forEach(video => {
      video.addEventListener('play', function() {
        gtag('event', 'video_start', {
          event_category: 'video',
          event_label: this.src || 'embedded_video'
        });
      });
      
      video.addEventListener('ended', function() {
        gtag('event', 'video_complete', {
          event_category: 'video',
          event_label: this.src || 'embedded_video'
        });
      });
    });
    
    // ØªØªØ¨Ø¹ Ø£Ø®Ø·Ø§Ø¡ JavaScript
    window.addEventListener('error', function(e) {
      gtag('event', 'exception', {
        description: `${e.filename}:${e.lineno} - ${e.message}`,
        fatal: false,
        event_category: 'javascript_error'
      });
    });
    
    // ØªØªØ¨Ø¹ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ØºÙŠØ± Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
    window.addEventListener('unhandledrejection', function(e) {
      gtag('event', 'exception', {
        description: `Unhandled Promise Rejection: ${e.reason}`,
        fatal: false,
        event_category: 'promise_error'
      });
    });
    
    // ØªØªØ¨Ø¹ Ø³Ø±Ø¹Ø© Ø§Ù„Ø§ØªØµØ§Ù„
    if ('connection' in navigator) {
      const connection = navigator.connection;
      gtag('event', 'connection_type', {
        event_category: 'performance',
        event_label: connection.effectiveType,
        value: Math.round(connection.downlink)
      });
    }
    
    // ØªØªØ¨Ø¹ Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²
    const deviceType = /Mobi|Android/i.test(navigator.userAgent) ? 'mobile' : 'desktop';
    gtag('event', 'device_type', {
      event_category: 'user_info',
      event_label: deviceType
    });
    
    // ØªØªØ¨Ø¹ Ø§Ù„Ù„ØºØ©
    gtag('event', 'language', {
      event_category: 'user_info',
      event_label: navigator.language || 'unknown'
    });
    
    // ØªØªØ¨Ø¹ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©
    gtag('event', 'timezone', {
      event_category: 'user_info',
      event_label: Intl.DateTimeFormat().resolvedOptions().timeZone
    });
    
    // Event Listeners
    let scrollTimeout;
    window.addEventListener('scroll', function() {
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(trackScrollDepth, 100);
    });
    
    // ØªØªØ¨Ø¹ Ø§Ù„ÙˆÙ‚Øª ÙƒÙ„ 15 Ø«Ø§Ù†ÙŠØ©
    setInterval(trackReadingTime, 15000);
    
    // ØªØªØ¨Ø¹ Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„ØµÙØ­Ø©
    window.addEventListener('beforeunload', function() {
      const timeSpent = Math.round((Date.now() - timeOnPage) / 1000);
      const sessionDuration = Math.round((Date.now() - sessionStartTime) / 1000);
      
      gtag('event', 'page_view_complete', {
        event_category: 'engagement',
        value: timeSpent,
        custom_parameter_1: userType,
        custom_parameter_2: maxScrollDepth
      });
      
      gtag('event', 'session_duration', {
        event_category: 'engagement',
        value: sessionDuration
      });
    });
    
    // ØªØªØ¨Ø¹ Ø§Ù„Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
    if (!isReturningVisitor) {
      gtag('event', 'first_visit', {
        event_category: 'user_behavior',
        event_label: 'new_user'
      });
    }
    
    // ØªØªØ¨Ø¹ PWA
    if (window.matchMedia('(display-mode: standalone)').matches) {
      gtag('event', 'pwa_usage', {
        event_category: 'app_behavior',
        event_label: 'standalone_mode'
      });
    }
    
    // ØªØªØ¨Ø¹ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¸Ù„Ù…
    if (document.documentElement.classList.contains('dark')) {
      gtag('event', 'theme_preference', {
        event_category: 'user_preference',
        event_label: 'dark_mode'
      });
    }
    
    console.log('âœ… Advanced Analytics: Initialized successfully');
  });
</script>