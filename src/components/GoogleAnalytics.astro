---
export interface Props {
  trackingId?: string;
}

const { trackingId = 'G-XXXXXXXXXX' } = Astro.props;

// ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¨ÙŠØ¦Ø©
const isDev = import.meta.env.DEV;
const isProduction = import.meta.env.PROD;
---

{!isDev && (
  <>
    <!-- Google Analytics 4 -->
    <script async src={`https://www.googletagmanager.com/gtag/js?id=${trackingId}`}></script>
    <script is:inline define:vars={{ trackingId, isProduction }}>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      
      // Ø¥Ø¹Ø¯Ø§Ø¯ Google Analytics
      gtag('js', new Date());
      gtag('config', trackingId, {
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø®ØµÙˆØµÙŠØ©
        anonymize_ip: true,
        allow_google_signals: false,
        allow_ad_personalization_signals: false,
        
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØªØ¨Ø¹
        page_title: document.title,
        page_location: window.location.href,
        content_group1: 'Ù…Ø¯ÙˆÙ†Ø© Ø¹Ø²ÙŠØ²',
        content_group2: 'Ø£Ù…Ø§Ù† ÙˆØªÙ‚Ù†ÙŠØ©',
        
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© (Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªØ§Ø¨Ø¹Ø©)
        send_page_view: true,
        
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø®ØµØµØ©
        custom_map: {
          'custom_parameter_1': 'user_type',
          'custom_parameter_2': 'content_category'
        }
      });
      
      // ØªØªØ¨Ø¹ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ø®ØµØµØ©
      window.trackEvent = function(action, category, label, value) {
        gtag('event', action, {
          event_category: category,
          event_label: label,
          value: value
        });
      };
      
      // ØªØªØ¨Ø¹ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
      window.addEventListener('error', function(e) {
        gtag('event', 'exception', {
          description: e.error ? e.error.toString() : 'Unknown error',
          fatal: false
        });
      });
      
      // ØªØªØ¨Ø¹ Ø§Ù„Ø£Ø¯Ø§Ø¡
      window.addEventListener('load', function() {
        setTimeout(function() {
          const perfData = performance.getEntriesByType('navigation')[0];
          if (perfData) {
            gtag('event', 'timing_complete', {
              name: 'page_load_time',
              value: Math.round(perfData.loadEventEnd - perfData.loadEventStart)
            });
            
            gtag('event', 'timing_complete', {
              name: 'dom_content_loaded',
              value: Math.round(perfData.domContentLoadedEventEnd - perfData.domContentLoadedEventStart)
            });
          }
        }, 0);
      });
      
      console.log('ðŸ“Š Google Analytics initialized:', trackingId);
    </script>
  </>
)}

{isDev && (
  <script is:inline>
    // Ù…Ø­Ø§ÙƒÙŠ Google Analytics Ù„Ù„ØªØ·ÙˆÙŠØ±
    window.gtag = function() {
      console.log('ðŸ“Š [DEV] Analytics Event:', arguments);
    };
    
    window.trackEvent = function(action, category, label, value) {
      console.log('ðŸ“Š [DEV] Custom Event:', { action, category, label, value });
    };
    
    console.log('ðŸ”§ [DEV] Analytics in development mode');
  </script>
)}